version: "3.9"
services:
  server:
    image: prefecthq/prefect:2-python3.10
    restart: always
    volumes:
      - prefect:/root/.prefect
      - /var/run/docker.sock:/var/run/docker.sock
    entrypoint: ["/opt/prefect/entrypoint.sh", "prefect", "server", "start"]
    environment:
      - PREFECT_UI_URL=http://127.0.0.1:4200/api
      - PREFECT_API_URL=http://127.0.0.1:4200/api
      - PREFECT_SERVER_API_HOST=0.0.0.0
    ports:
      - 4200:4200
    profiles: ["server"]

volumes:
  prefect:
  db:
  minio:
networks:
  default:
    name: prefect-network